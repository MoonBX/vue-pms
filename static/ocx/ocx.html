<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- saved from url=(0014)about:internet-->

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>读写器测试(Javascript)</title>
  <link rel="stylesheet" href="jquery.toast.min.css">
  <script src="jquery.min.js"></script>
  <script src="jquery.toast.min.js"></script>
  <script language="javascript" src="http://127.0.0.1:8008/YOWOCloudRFIDReader.js"></script>
</head>

<script>
  var ua = navigator.userAgent;
  if(ua.indexOf("Mac OS X") !== -1){
    alert("读卡器不支持OSX系统, 请使用Windows系统进行读卡操作");
  }else{
    try {
      var rfidreader = YOWORFIDReader.createNew();
    } catch (e) {
      alert("创建读卡器连接失败，请先下载安装！");
      top.location = "http://www.youwokeji.com.cn/CloudReader/YOWORFIDReaderCloudForWeb.exe";
    }
  }

  if (ua.indexOf("Windows NT 5.1") !== -1) console.log("Windows Vista");
  if (ua.indexOf("Windows NT 6.1") !== -1) console.log("Windows 7");
  if (ua.indexOf("Windows NT 6.2") !== -1) console.log("Windows 8");
  if (ua.indexOf("Windows NT 10") !== -1) console.log("Windows 10");
  if (ua.indexOf("Mac OS X") !== -1) console.log("OSX");

  if (!rfidreader.TryConnect()) {
    alert("浏览器不支持，请更换浏览器后重试！");
  }

  rfidreader.onResult(function (resultdata) {
    var cardBox = $('.cards-box');
    var currentIndex = cardBox.children(".row").length-1;
    var firstInput = cardBox.children(".row").eq(0).children("input")[0].value;
    var length = cardBox.children(".row").length;

    switch (resultdata.FunctionID) {

      case 0:
        if (resultdata.Result > 0) {
          for (var k = 0; k < length; k++) {
            if ("IC-" + resultdata.strData.slice(2) == cardBox.children(".row").eq(k).children("input")[0].value) {
              test('重复读卡');
              length = 0;
              break;
            }
          }
          for (var j = 0; j < length; j++) {
            if ("IC-" + resultdata.strData.slice(2) == cardBox.children(".row").eq(j).children("input")[0].value) {
              test('重复读卡');
              break;
            }

            if (!cardBox.children(".row").eq(j).children("input")[0].value) {
              document.getElementById("CardNo" + j).value = "IC-" + resultdata.strData.slice(2);
              break;
            }

            if (j == cardBox.children(".row").length - 1) {
              if (!firstInput && currentIndex == 0) {
                document.getElementById("CardNo0").value = "IC-" + resultdata.strData.slice(2);
              } else if (firstInput && currentIndex == 0) {
                cardBox.append('<div class="row m-b-sm"> <label class="w-label-control" style="width:70px;color: rgba(0, 0, 0, 0.85);">卡2:</label> <input type="text" class="ant-input" name="CardNo1" id="CardNo1" disabled><img src="delete.png" alt="" width="12px" height="12px" onclick="lay(this)"></div>');
                document.getElementById("CardNo1").value = "IC-" + resultdata.strData.slice(2);
              } else if (currentIndex > 0 && currentIndex < 9) {
//            console.log(currentIndex);
                cardBox.append('<div class="row m-b-sm"> <label class="w-label-control" style="width:70px;color: rgba(0, 0, 0, 0.85);">卡' + (currentIndex + 2) + ':</label> <input type="text" class="ant-input" name="CardNo' + (currentIndex + 1) + '" id="CardNo' + (currentIndex + 1) + '" disabled><img src="delete.png" alt="" width="12px" height="12px" onclick="lay(this)"></div>');
                document.getElementById("CardNo" + (currentIndex + 1)).value = "IC-" + resultdata.strData.slice(2);
              } else {
                console.log('end');
              }
            }
          }
        }else{
          test('读卡失败')
        }
        break;
    }
  });

  function Start() {
    var OrderID = 0;
    var FormatID = 1;
    rfidreader.Repeat = 0;
    rfidreader.HaltAfterSuccess = 0;
    rfidreader.BeepOnSuccess = 0;
    rfidreader.RequestTypeACardNo(FormatID, OrderID);
  }

  function test(text) {
    $.toast({
      text: text,
      hideAfter: 1000,
      loader: false
    })
  }

  function lay(x){
    $(x).prev().val("");
  }
</script>

<body>
<style>
  body{
    margin: 0;
    font-family: "arial";
    font-size: 13px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    line-height: 1.42857143;
    background-color: transparent;
    color: rgba(0, 0, 0, 0.65);
  }
  .other-info .title {
    margin-right: 10px;
    display: inline-block;
    width: 70px;
    text-align: right;
    color: #999999;
  }

  .p-v-md {
    padding-top: 20px;
    padding-bottom: 20px
  }

  .p-h-sm {
    padding-right: 10px;
    padding-left: 10px
  }

  .p-sm {
    padding: 10px;
  }

  .pull-left {
    float: left;
  }

  .m-b-sm {
    margin-bottom: 10px;
  }

  .w-label-control {
    float: left;
    text-align: right;
    margin-top: 5px;
    margin-right: 2px;
  }

  .row {
    width: 100%;
    display: inline-block;
    position: relative;
  }

  .m-r-md {
    margin-right: 20px
  }

  .ant-btn{
    display: inline-block;
    text-align: center;
    touch-action: manipulation;
    cursor: pointer;
    background-image: none;
    border: 1px solid transparent;
    white-space: nowrap;
    line-height: 1.5;
    padding: 0 15px;
    font-size: 12px;
    border-radius: 4px;
    height: 28px;
    user-select: none;
    transition: all 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);
    position: relative;
    color: rgba(0, 0, 0, 0.65);
    background-color: #fff;
    border-color: #d9d9d9;
  }
  .ant-btn:focus{
    outline: none;
  }

  .ant-btn-primary {
    color: #fff;
    background-color: #108ee9;
    border-color: #108ee9;
  }
  .cards-box {
    width: 400px;
    height: 220px;
    /*background: #F0F6FF;*/
    /*padding-top: 15px;*/
  }

  .cards-box .row {
    /*flex-grow: 0;*/
    float: left;
    width: 50%;
  }

  .clear {
    text-decoration: none;
    font-size: 12px;
    line-height: 30px;
  }

  .btn {
    display: inline-block;
    padding: 6px 12px;
    font-size: 14px;
    line-height: 1.4285;
    text-align: center;
    white-space: nowrap;
    vertical-align: middle;
    cursor: pointer;
    border: 1px solid transparent;
  }

  .p-h-lg {
    padding-right: 30px;
    padding-left: 30px;
  }

  .m-b-md {
    margin-bottom: 20px;
  }

  .btn-primary:hover, .btn-primary:focus {
    color: #ffffff !important;
    background-color: #4E85DE !important;
    border-color: #4E85DE !important;
  }

  .btn-primary {
    color: #ffffff !important;
    background-color: #4E85DE !important;
    border-color: #4E85DE !important;
  }

  .text-center {
    text-align: center;
  }
  .row img{
    position: relative;
    top: 2px;
    left: -19px;
  }
  .ant-input{
    position: relative;
    display: inline-block;
    padding-left: 7px;
    width: 100px;
    height: 24px;
    font-size: 13px;
    line-height: 1.5;
    color: rgba(0, 0, 0, 0.65);
    background-color: #fff;
    border: 1px solid #d9d9d9;
    border-radius: 4px;
    transition: all .3s;
  }
</style>
<div class="other-info clearfix">
  <div class="pull-left cards-box" id="cardBox">
    <div class="row m-b-sm">
      <label class="w-label-control" style="width:70px;color: rgba(0, 0, 0, 0.85);">卡1：</label>
      <input type="text" disabled
             name="CardNo0" id="CardNo0"
             class="ant-input">
      <img src="delete.png" alt="" width="12px" height="12px" onclick="lay(this)">
    </div>
  </div>
  <div class="text-center p-h-sm" style="width: auto; overflow: auto">
    <button class="ant-btn ant-btn-primary m-b-sm" name="RequestCard1" value="寻卡" onClick="Start()">读取卡号</button>
    <div class="m-b-md"><a href="http://www.youwokeji.com.cn/CloudReader/YOWORFIDReaderCloudForWeb.exe">下载插件</a></div>
  </div>
</div>
</body>


</html>
